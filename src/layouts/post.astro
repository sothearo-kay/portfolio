---
import type { CollectionEntry } from "astro:content"
import BlogMeta from "~/components/blog/BlogMeta.astro"
import BlogNav from "~/components/blog/BlogNav.astro"
import BlogReadingProgressBar from "~/components/blog/BlogReadingProgressBar.svelte"
import Heading from "~/components/common/Heading.astro"
import Paragraph from "~/components/common/Paragraph.astro"
import ScrollBlur from "~/components/common/ScrollBlur.astro"
import Separator from "~/components/common/Separator.astro"
import Layout from "~/layouts/default.astro"
import "~/styles/code.css"
import "~/styles/prose.css"

interface Props {
  entry: CollectionEntry<"blog">
  prevPost: CollectionEntry<"blog"> | null
  nextPost: CollectionEntry<"blog"> | null
  readingTime?: string
}

const { entry, prevPost, nextPost, readingTime } = Astro.props
const ogImage = `/blog/${entry.id}/og.png`
---

<Layout
  title={entry.data.title}
  description={entry.data.description}
  {ogImage}
  type="article"
  includeKatex
  includeScripts
>
  <article class="post">
    <header class="header">
      <Heading as="h1" size="2xl" reset>{entry.data.title}</Heading>
      <Paragraph secondary class="text">{entry.data.description}</Paragraph>
      <BlogMeta date={entry.data.publishedAt} tags={entry.data.tags} readingTime={readingTime} />
    </header>

    <div class="prose">
      <Separator />
      <slot />
    </div>

    <BlogNav {prevPost} {nextPost} />
  </article>

  <ScrollBlur slot="extras" />
  <BlogReadingProgressBar slot="extras" client:idle />
</Layout>

<style>
  .post {
    padding-top: 2rem;

    .header {
      & .text {
        margin-top: 0.5rem;
        margin-bottom: 0.75rem;
      }
    }

    .prose {
      .separator {
        margin-block: var(--block-spacing);
      }
    }
  }
</style>
