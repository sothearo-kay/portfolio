---
import type { CollectionEntry } from "astro:content"
import { getCollection, render } from "astro:content"
import BlogLayout from "~/layouts/blog.astro"

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog", ({ data }) => !data.draft)
  const sortedEntries = blogEntries.sort((a, b) =>
    new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime(),
  )

  return sortedEntries.map((entry, index) => ({
    params: { slug: entry.id },
    props: {
      entry,
      prevPost: index < sortedEntries.length - 1 ? sortedEntries[index + 1] : null,
      nextPost: index > 0 ? sortedEntries[index - 1] : null,
    },
  }))
}

interface Props {
  entry: CollectionEntry<"blog">
  prevPost: CollectionEntry<"blog"> | null
  nextPost: CollectionEntry<"blog"> | null
}

const { entry, prevPost, nextPost }: Props = Astro.props
const { Content } = await render(entry)
---

<BlogLayout {entry} {prevPost} {nextPost}>
  <Content />
</BlogLayout>
