---
import type { CollectionEntry } from "astro:content"
import { getCollection, render } from "astro:content"
import BlogMeta from "~/components/blog/BlogMeta.astro"
import Container from "~/components/common/Container.astro"
import Heading from "~/components/common/Heading.astro"
import Paragraph from "~/components/common/Paragraph.astro"
import Separator from "~/components/common/Separator.astro"
import Layout from "~/layouts/blog.astro"
import "~/styles/code.css"
import "~/styles/prose.css"

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog", ({ data }) => !data.draft)
  return blogEntries.map(entry => ({
    params: { slug: entry.id },
    props: { entry },
  }))
}

interface Props {
  entry: CollectionEntry<"blog">
}

const { entry }: Props = Astro.props
const { Content } = await render(entry)
---

<Layout title={entry.data.title} description={entry.data.description}>
  <article class="post">
    <Container as="header" class="header">
      <Heading as="h1" size="2xl">{entry.data.title}</Heading>
      <Paragraph>{entry.data.description}</Paragraph>
      <BlogMeta date={entry.data.publishedAt} tags={entry.data.tags} />
    </Container>

    <Container class="prose">
      <Separator />
      <Content />
    </Container>
  </article>
</Layout>

<style>
.post {
  padding-top: 2rem;

  .header {
    & h1 {
      margin-block: 0;
    }

    & p {
      margin-top: 0.5rem;
      margin-bottom: 0.75rem;
    }
  }

  .prose {
    & .separator {
      margin-block: 1.75rem;
    }
  }
}
</style>
