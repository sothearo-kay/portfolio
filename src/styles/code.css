:root {
  --shiki-light-bg: oklch(98% 0.003 240deg);
}

[data-theme="dark"] {
  .astro-code,
  .astro-code span {
    color: var(--shiki-dark) !important;
    background-color: var(--shiki-dark-bg) !important;
    /* Optional, if you also want font styles */
    font-style: var(--shiki-dark-font-style) !important;
    font-weight: var(--shiki-dark-font-weight) !important;
    text-decoration: var(--shiki-dark-text-decoration) !important;
  }
}

code {
  background-color: var(--color-accent);
  font: var(--font-code-inline);
  border-radius: 4px;
  padding: 0.1rem 0.2rem;
}

pre {
  background-color: var(--shiki-light-bg) !important;
  overflow-x: auto;
  border-radius: 10px;
  tab-size: 2;
  -webkit-text-size-adjust: none;

  & code {
    display: grid;
    padding: 10px 0;
    background-color: transparent;
    font: var(--font-code-block);
    counter-reset: line;
    counter-increment: line 0;

    span.line {
      padding-inline: 0.5rem;
      border-left: 3px solid transparent;

      &::before {
        color: color-mix(
          in srgb,
          var(--color-foreground-muted) 70%,
          transparent
        );
        content: counter(line);
        counter-increment: line;
        width: 1rem;
        margin-right: 1rem;
        display: inline-block;
        text-align: right;
      }

      &.highlighted {
        background-color: var(--color-code-highlight) !important;
        border-left-color: var(--color-accent-foreground);
      }

      &.diff.add {
        background-color: color-mix(
          in srgb,
          var(--color-diff-add) 15%,
          transparent
        ) !important;
        border-left-color: var(--color-diff-add);

        &::before {
          color: var(--color-diff-add);
        }
      }

      &.diff.remove {
        background-color: color-mix(
          in srgb,
          var(--color-diff-remove) 15%,
          transparent
        ) !important;
        border-left-color: var(--color-diff-remove);

        &::before {
          color: var(--color-diff-remove);
        }
      }

      &:is(.highlighted, .focused, .diff) {
        & > span {
          background-color: transparent !important;
        }
      }
    }

    &:has(.focused) span.line:not(.focused) {
      opacity: 0.4;
      filter: blur(1px);
      transition:
        opacity 0.2s ease,
        filter 0.2s ease;
    }

    &:has(.focused):hover span.line:not(.focused) {
      opacity: 1;
      filter: none;
    }
  }
}
