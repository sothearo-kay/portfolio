---
import SearchIcon from "~/icons/search.svg"
import Separator from "../common/Separator.astro"
import ThemeToggle from "../ThemeToggle.astro"

const navItems = [
  { href: "/", text: "Home" },
  { href: "/blog", text: "Blog" },
  { href: "/projects", text: "Projects" },
]

const currentPath = new URL(Astro.request.url).pathname

function isActive(href: string) {
  const normalizedCurrent = currentPath === "/" ? "/" : currentPath.replace(/\/$/, "")
  const normalizedHref = href === "/" ? "/" : href.replace(/\/$/, "")
  return normalizedCurrent === normalizedHref
}
---

<header class="header">
  <div class="wrapper" transition:name="header-wrapper">
    <nav class="nav">
      <ul class="nav-list">
        {navItems.map(item => (
          <li class="nav-item">
            <a href={item.href} class:list={["nav-link", { active: isActive(item.href) }]}>
              {item.text}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <Separator orientation="vertical" />

    <div class="actions">
      <button id="search-trigger" class="search-button" aria-label="Open search">
        <SearchIcon class="search-icon" />
        <span class="shortcut" id="search-shortcut">
          <kbd class="tag">âŒ˜K</kbd>
        </span>
      </button>

      <ThemeToggle />
    </div>
  </div>
</header>

<style>
  .header {
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 1rem;
    left: 50%;
    transform: translateX(-50%);

    .wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      padding-block: 0.5rem;
      padding-inline: 1rem;
      border-radius: 999px;
      background-color: var(--color-background-elevated-transparent);
      border: 1px solid var(--color-border-subtle);
      box-shadow: var(--shadow-header);
      backdrop-filter: blur(0);
    }

    .nav-list {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .nav-item {
      font-size: 14px;
      font-weight: 500;

      .nav-link {
        padding: 0.5rem;
        color: var(--color-accent-foreground);
        transition: color 0.2s ease;

        &:hover,
        &.active {
          color: var(--color-foreground);
        }
      }
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
  }

  .search-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.4rem 0.6rem;
    background-color: var(--color-background-secondary);
    border-radius: 999px;
    color: var(--color-accent-foreground);
    font-size: 14px;
    cursor: pointer;
    box-shadow: var(--shadow-inset);

    &:active {
      transform: scale(0.98);
    }

    .search-icon {
      width: 16px;
      height: 16px;
    }

    .shortcut {
      kbd {
        font-size: 12px;
        font-family: var(--font-heading);
        padding: 0.125rem 0.25rem;
        border: none;
        border-radius: 4px;
        letter-spacing: 0.25rem;
        background: var(--color-background-interactive);
      }

      span {
        font-size: 12px;
        padding: 0.25rem 0.5rem;
        color: var(--color-accent-foreground);
        font-family: inherit;
      }
    }
  }
</style>
